コードの品質についてチェックを行いリファクタリング案を提示します。
適切に関数分割やクラスへの統合を行います。
日本語でのコメントおよび日本語でのGoogle Styleのdocstring、型ヒントを付与します。
変数名や関数名は内容に応じた名前にします。
変更が多い場合でも出力は省略しません。